# plan テンプレート

以下はClaude Codeのplanに渡すプロンプトのテンプレート。
`{{変数名}}` の部分をPhase 1で収集した情報で置換してから使用すること。

---

マネタイズを最優先に設計したスマホアプリを企画・設計してほしい。
「稼げるかどうか」を全ての意思決定の最上位基準とする。

技術スタック：{{tech_stack}}
課金基盤：{{payment_platform}}
ターゲット市場：{{target_market}}
開発期間：{{dev_timeline}}
{{#if genre}}注力ジャンル：{{genre}}{{/if}}
{{#if user_idea}}ユーザーの初期アイデア：{{user_idea}}{{/if}}
{{#if user_direction}}ユーザーの興味方向：{{user_direction}}{{/if}}
{{#if revenue_goal}}月間売上目標：{{revenue_goal}}{{/if}}
{{#if agent_team}}plan完了後、tasksコマンドでタスク分解し、AgentTeamで並列開発する前提で設計すること。{{/if}}

---

## ステップ1：マネタイズファーストなアイデア出し

{{#if user_idea}}
### ユーザーの初期アイデア
「{{user_idea}}」

このアイデアを最優先候補として扱い、以下の3段構えで出力すること：

1. **ユーザーアイデアのマネタイズ強化版**（2〜3パターン）
   - 元のアイデアをベースに、課金モデル・Day 0設計を最適化した改善案
   - 「このアイデアをこう変えると、もっと稼げる」という提案

2. **同ジャンルの別アプローチ**（2〜3個）
   - ユーザーの興味領域内で、別角度から攻める案

3. **全く別方向の高ROI案**（3〜4個）
   - ユーザーのアイデアと比較するための案（視野を広げる目的）

合計10個以上出した上で、ユーザーのアイデアを含めた中から最もROIが高いものを推薦すること。
ユーザーのアイデアが最善なら素直にそれを推す。別の案が優れているなら、その理由を正直に説明する。
{{/if}}

{{#if user_direction}}
### ユーザーの興味方向
「{{user_direction}}」

この方向に重点を置きつつ、以下の3方向で出す。方向A・Cはこの領域内、方向Bは領域外からも出してよい。
{{/if}}

{{#unless user_idea}}{{#unless user_direction}}
以下の3方向から合計10個以上のアイデアを出してください。
{{/unless}}{{/unless}}

全てのアイデアを「どう稼ぐか」から逆算して設計すること。
特に「インストール初日に課金が発生する」構造を必須条件とする。

### 方向A：王道（実績ある課金モデル × 改善余地のあるジャンル）
- App Store/Google Playの売上上位カテゴリから、個人〜少人数で勝てる隙間を狙う
{{#if genre}}- 特に{{genre}}領域で狙えるポジションを優先{{/if}}

### 方向B：逆張り（既存アプリが取りこぼしている課金機会）
- 無料で提供されているが、本来お金を払う価値があるもの
- 課金導線が弱い人気アプリの改善版

### 方向C：組み合わせ（高LTVモデル × 新技術）
- AI/パーソナライゼーション × サブスク
- 習慣形成 × 課金トリガー

各アイデアには以下を記載：

| 項目 | 内容 |
|------|------|
| アプリ名 | 英語名（グローバル展開可能、App Store検索で有利な名前） |
| サブタイトル | App Storeのサブタイトル案（30文字以内、機能が伝わる） |
| 一言説明 | 何をするアプリか |
| 課金モデル | サブスク/買い切り/フリーミアム/複合型 |
| 想定月額 or 価格 | 具体的な金額（日本円） |
| 想定LTV | 1ユーザーあたりの生涯価値 |
| 課金率の見込み | 無料→有料の転換率予測 |
| マネタイズの強さ | ◎/○/△ と理由 |
| 初日課金の仕組み | インストール当日に課金が発生する導線の概要 |
| 開発難易度 | 低/中/高 |
| 市場規模感 | 小/中/大 |

アプリ名は以下の基準で命名すること：
- 短く覚えやすい（2〜3音節が理想）
- App Store / Google Playで商標・既存アプリと被らなそうなもの
- ドメイン・SNSハンドルが取得可能そうなもの
- アプリの価値が名前から連想できる

最後に「マネタイズの強さ × 開発難易度の低さ」で最もROIが高い1つを選び、選定理由を説明してください。

---

## ステップ2：課金設計（最重要セクション）

選定アイデアについて、マネタイズを徹底的に設計する。

### 2-1. 即日売上設計（Day 0 Revenue）
インストール初日に売上が発生する仕組みを最優先で設計すること。以下を全て定義：

- Day 0 課金導線：インストール→価値体験→課金までを最短何分で到達させるか
- オンボーディング内課金トリガー：初回体験中に「これは有料でも欲しい」と思わせるモーメント設計
- 即決させる価格戦略：
  - 初回限定オファー（期間限定の割引、インストール後24時間以内の特別価格）
  - 年額プランの初回提示（月額より年額を先に見せてアンカリング）
  - トライアル開始のハードル最小化（ワンタップ開始）
- FOMO（見逃し不安）の活用：
  - 初回限定価格のカウントダウン
  - 無料版の制限を早期に体感させる設計
  - 「今始めないと損」と感じさせる仕掛け
- 即日課金に最適なペイウォールパターン：
  - オンボーディング完了直後のフルスクリーンペイウォール
  - コア機能を1回体験→2回目でペイウォール
  - どのパターンを採用するか、理由とともに提示

### 2-2. 課金アーキテクチャ
- 課金モデルの詳細設計（プラン構成、価格、トライアル期間）
- ペイウォール戦略（ハード vs ソフト、表示タイミング、トリガー条件）
- 無料機能 vs 有料機能の線引き（無料で価値を感じさせ、有料で手放せなくする）
- アップセル導線の設計（フリー→月額→年額のファネル）
- 価格テスト戦略（A/Bテストの設計）

### 2-3. RevenueCat実装設計
- Offering構成（パッケージ設計）
- Entitlement設計（機能アクセス制御）
- Paywall UIの方針（RevenueCat Paywalls SDK vs カスタム）
- サブスクリプションのライフサイクル管理
  - トライアル→有料転換
  - 解約防止（Grace Period、Billing Retry）
  - 解約理由の収集と対策
- Webhook設計（サーバーサイド検証）
- RevenueCat Experiments（A/Bテスト）の活用方針

### 2-4. 課金KPI設計
以下のKPIについて目標値と計測方法を定義：
- 【Day 0指標】インストール→初日課金の転換率
- 【Day 0指標】オンボーディング完了→ペイウォール表示→購入の各ステップ転換率
- 【Day 0指標】初回限定オファーの適用率
- Install → Trial開始率
- Trial → 有料転換率
- 月次チャーンレート
- ARPPU（有料ユーザーあたり月間売上）
- LTV（3ヶ月/6ヶ月/12ヶ月）
- CAC上限（LTVから逆算）
- MRR目標（3ヶ月/6ヶ月/12ヶ月後）

### 2-5. 収益シミュレーション
以下の前提でシミュレーションを表形式で作成：
- 月間新規インストール：1,000 / 5,000 / 10,000 の3パターン
- Day 0 課金率を含めた初月売上の内訳（即日売上 vs 後日転換）
- 各パターンでのMRR推移（12ヶ月分）
- 損益分岐点の試算

---

## ステップ3：プロダクト定義（課金設計に従属させる）

### 3-1. ユーザー体験設計（Day 0 Revenue導線を組み込む）
- インストール→価値体験→課金の最短フロー（分単位で設計）
- オンボーディングの各ステップと課金トリガーの対応表
- 課金につながるコアループ（毎日使う理由 → 課金トリガー）
- 無料ユーザーへの制限の見せ方（不快にせず欲しくさせる）

### 3-2. MVP機能定義
- 課金に直結する機能（Must）
- 継続率を上げる機能（Should）
- あると嬉しい機能（Could、Phase2以降）
- やらないこと（Won't）

### 3-3. アプリ名・ブランディング最終決定
- 正式アプリ名（ステップ1の候補から確定 or 改善）
- App Storeサブタイトル（30文字以内）
- 一言キャッチコピー（マーケティング用）
- アプリアイコンのコンセプト（色・モチーフの方向性）
- 名前の検証チェックリスト：
  - App Store / Google Playで同名アプリがないか
  - 商標リスクがなさそうか
  - .com または .app ドメインが空いていそうか
  - X / Instagram のハンドルが取れそうか

### 3-4. 競合の課金分析
- 類似アプリ3つの課金モデル・価格・ペイウォール分析
- 各競合の課金導線の弱点
- 本アプリが課金で勝てるポイント

---

## ステップ4：技術設計{{#if agent_team}}（AgentTeam並列開発を前提）{{/if}}

### 4-1. アーキテクチャ
- {{tech_stack}} のプロジェクト構成
- バックエンド（Supabase推奨、理由も記載）
- 認証（Supabase Auth + Apple/Google Sign-In）
- DB設計の方針（ユーザー、サブスクリプション状態、コンテンツ）
- 状態管理（Zustand推奨）
- 外部SDK一覧

### 4-2. ディレクトリ構成
{{#if agent_team}}AgentTeamで各エージェントが独立して作業できるよう、モジュール境界が明確な構成にすること。{{/if}}

```
app/
├── (tabs)/
├── (auth)/
├── (onboarding)/
├── (paywall)/
src/
├── features/          {{#if agent_team}}# AgentTeam分割単位{{/if}}
│   ├── auth/
│   ├── subscription/  # RevenueCat連携
│   ├── onboarding/
│   ├── [core-feature-1]/
│   ├── [core-feature-2]/
│   └── settings/
├── shared/            # 共通{{#if agent_team}}（変更時はAgent間調整必要）{{/if}}
│   ├── components/
│   ├── hooks/
│   ├── utils/
│   └── types/
├── services/          # 外部サービス連携
│   ├── revenuecat/
│   ├── supabase/
│   └── analytics/
└── config/
```

{{#if agent_team}}
### 4-3. AgentTeam分割の提案
このアプリに最適なAgentTeam構成を提案してください。確定ではなく、こちらで判断するための材料として出力すること。

以下の観点で提案：
- Agent数（3〜6の範囲で、このアプリの規模に応じて最適な数）
- 各Agentの担当範囲と責務
- Agent間の依存関係図（どのAgentがどのAgentの成果物に依存するか）
- 先に完成すべきshared interface一覧
- 並列度（同時に何Agentが動けるか）

また、提案に加えて以下も記載：
- この分割にした理由
- 別の分割案（もう1パターン）とそのトレードオフ
- 「課金周り」を独立Agentにすべきか、コア機能に統合すべきかの判断材料
{{/if}}

---

## ステップ5：開発ロードマップ{{#if tasks}}（tasksコマンド変換前提）{{/if}}

{{#if tasks}}各タスクをそのまま `tasks` コマンドに登録できる粒度で記述すること。{{/if}}
各タスクに以下を付与：
{{#if agent_team}}- 推奨担当Agent（ステップ4-3の提案に基づく仮割り当て）{{/if}}
- 依存タスク（ブロッカー）
- 完了条件（Definition of Done）
- 推定サイズ（S/M/L）

{{#if agent_team}}※ Agent割り当ては確定ではなく、AgentTeam構成の決定後に調整する前提で記載すること。{{/if}}

### Phase 0：プロジェクト基盤（Day 1-2）
- Expo プロジェクト初期化
- ディレクトリ構成セットアップ
- 共通型定義（types/）
{{#if agent_team}}- shared interface の定義（Agent間の契約）{{/if}}
- CLAUDE.md の配置

### Phase 1：認証 + 課金基盤（Week 1）【最優先】
- Supabase Auth セットアップ
- RevenueCat SDK導入 + Offering設定
- Entitlement チェックの hook 作成
- ペイウォール画面（仮UI）

### Phase 2：コア機能MVP（Week 2-3）
- コア機能の実装{{#if agent_team}}（AgentTeamで並列）{{/if}}
- オンボーディングフロー
- 無料/有料の機能出し分け

### Phase 3：課金最適化（Week 4-5）【収益直結】
- ペイウォールUIの本実装（複数パターン）
- RevenueCat Experiments設定
- 解約防止フロー
- 課金イベントのトラッキング

### Phase 4：品質 + リリース（Week 6）
- E2Eテスト（課金フローは必須）
- App Store / Google Play 申請準備
- ASO（App Store Optimization）基本設定

---

## ステップ6：CLAUDE.md 生成

プロジェクトルートに配置するCLAUDE.mdを生成。以下を含めること：

- プロジェクト概要（マネタイズ目標を明記）
- 技術スタック一覧
- ディレクトリ構成ルール
- コーディング規約（命名規則、コンポーネント設計、状態管理）
- RevenueCat実装ルール（Entitlement命名、課金状態の型定義、ペイウォール実装パターン）
- テスト方針（課金フローのテストは必須）
{{#if agent_team}}- AgentTeam向けルール（AgentTeam構成確定後に更新する前提のテンプレート）
  - Agent担当範囲の記載欄
  - shared/ への変更ルール（他Agentとの調整が必要）
  - features/ 内は担当Agentのみ変更可{{/if}}
{{#if tasks}}- tasksコマンドへの変換ガイド{{/if}}

---

## 出力形式

- 全ステップをMarkdownで構造化して出力
- ステップ2の収益シミュレーションは表形式で
- ステップ6のCLAUDE.mdはそのままファイル保存可能な形式で
{{#if tasks}}- 各タスクはチェックリスト形式で（tasks変換しやすくする）{{/if}}